package com.nordicsemi.Myfiles;

import android.content.Context;

import java.util.Set;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.telephony.SmsMessage;
import android.util.Log;
import android.widget.Toast;

//?????????????????????????????????????????????????????????????????????????  
/* ?????????BroadcastReceiver??,???????????????? */  
public class EX06_01_SMSreceiver extends BroadcastReceiver   
{   
 /*????????????,?????android.provider.Telephony.SMS_RECEIVED???Action??????????*/  
private static final String mACTION = "android.provider.Telephony.SMS_RECEIVED";   
  
/* 
 * ????????????????????????? 
 * ????????????????????Intent??????????????????Intent???? 
 * @see android.content.BroadcastReceiver#onReceive(android.content.Context, android.content.Intent) 
 */  
@Override   
public void onReceive(Context context, Intent intent)
{   
  // TODO Auto-generated method stub   
  /* ??????Intent???????? 
   * ???????????????? 
   * */  
  if (intent.getAction().equals(mACTION))   
  {   
    /*???????????????????sb*/  
    StringBuilder sb = new StringBuilder();   
    /*??????Intent??????????*/  
    Bundle bundle = intent.getExtras();   
    /*???Intent????????*/  
    if (bundle != null)   
    {  
      Set<String> keysSet=bundle.keySet();  
      for(String keyString:keysSet){  
        Log.d("key", keyString);  
      }  
      /* pdus? android?????????? identifier 
       * ???bundle.get("")???????????pdus?????*/  
      Object[] myOBJpdus = (Object[]) bundle.get("pdus");   
      /*???????????array,?????????????????????array????*/  
      SmsMessage[] messages = new SmsMessage[myOBJpdus.length];    
      for (int i = 0; i<myOBJpdus.length; i++)   
      {    
        messages[i] = SmsMessage.createFromPdu ((byte[]) myOBJpdus[i]);    
      }   
          
      /* ???????????????????????StringBuilder???? */    
      for (SmsMessage currentMessage : messages)   
      {    
        sb.append("?????????:\n");    
        /* ??????????? */   
        sb.append(currentMessage.getDisplayOriginatingAddress());    
        sb.append("\n------?????????------\n");    
        /* ??????????BODY */    
        sb.append(currentMessage.getDisplayMessageBody());    
      }    
    }      
    /* ??Notification(Toase)??????????  */  
    Toast.makeText(context, sb.toString(), Toast.LENGTH_LONG).show();   
       
    /* ??????Activity */   
//    Intent i = new Intent(context, EX06_01.class);   
//    Bundle bundle2=new Bundle();  
//    bundle2.putString("SMS", sb.toString());  
//    i.putExtra("SMSS", bundle2);  
//    /*?????Activity????????task?????*/  
//    i.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);   
//    context.startActivity(i);   
  }   
}   
}   
